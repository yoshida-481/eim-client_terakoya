<div class="eim-form-item">
	<label *ngIf="label" [ngClass]="{'eim-form-label': true, 'eim-form-label-required': required}">{{label}}</label>

	<div class="eim-form-input eim-form-input-selected-list">
		<span *ngIf="topMessage" [innerHTML]="topMessage"></span>
			<div class="eim-form-input-multi">
				<span *ngIf="leftMessage" class="eim-input-form-item-left-message" [innerHTML]="leftMessage"></span>
					<!-- 成果物一覧 -->
					<eim-data-grid
						#taskOutputFileDataGrid
						class="eim-form-input-multi-input" style="height: 180px;"
						(changed)="onChangedTaskOutputFile($event)"
						(cellEditingStarted)="onCellEditingStarted($event)" (cellEditingStopped)="onCellEditingStopped($event)"
						[contextMenuItems]="gridContextMenuItems">
					</eim-data-grid>
					<span *ngIf="rightMessage" class="eim-input-form-item-right-message" [innerHTML]="rightMessage"></span>
					<div class="eim-form-input-multi-button-container">
						<div *ngIf="!disabled" class="eim-form-input-multi-button-row">
							<!-- 雛型ファイル取込 -->
							<button pButton type="button"
									class="eim-form-input-multi-button p-button-info icon-only-button" icon="fa fa-download"
									pTooltip="{{ 'EIM_TASKS.LABEL_03022' | translate }}"
									[disabled]="templateFileAttributeValues.length === 0"
									(click)="onClickSelectFromTemplateFile($event)"></button>
							<!-- 削除 -->
							<button pButton type="button"
									class="p-button-danger eim-form-input-multi-button icon-only-button" icon="fa fa-times"
									pTooltip="{{ 'EIM.LABEL_03003' | translate }}"
									[disabled]="selectedData.length === 0"
									(click)="onClickDelete($event)"></button>
						</div>
						<div *ngIf="!disabled" class="eim-form-input-multi-button-row">
							<!-- アップロード -->
							<label class="eim-upload-btn eim-form-input-multi-button eim-icon-only-button"
									pTooltip="{{ 'EIM.LABEL_03008' | translate }}">
								<i class="eim-upload-btn-icon fa fa-upload"></i>
								<input type="file" ng2FileSelect [uploader]="uploader" multiple [ngStyle]="{'display': 'none'}"/>
							</label>
						</div>
						<div *ngIf="!disabled" class="eim-form-input-multi-button-row"></div>
						<div *ngIf="!disabled" class="eim-form-input-multi-button-row">
							<!-- 直接編集 -->
							<button *ngIf="enabledWebDAV" pButton type="button" class="eim-form-input-multi-button p-button-info eim-icon-only-button"
									icon="fa fa-pencil-square-o" pTooltip="{{ 'EIM.LABEL_03048' | translate }}"
									(click)="onClickEdit($event)" [disabled]="!editableWebDAV"></button>

							<!-- チェックイン -->
							<button pButton type="button"
									class="eim-form-input-multi-button p-button-info eim-icon-only-button" icon="eim-icon-checkin"
									pTooltip="{{ 'EIM_TASKS.LABEL_03031' | translate }}"
									[disabled]="selectedData.length === 0"
									(click)="onClickCheckin($event)"></button>
						</div>
						<div *ngIf="!disabled" class="eim-form-input-multi-button-row"></div>
						<div class="eim-form-input-multi-button-row">
							<!-- 一括ダウンロード -->
							<button pButton type="button"
									class="p-button-info eim-form-input-multi-button eim-icon-only-button" icon="eim-icon-download"
									pTooltip="{{ 'EIM_TASKS.LABEL_03029' | translate }}"
									[disabled]="value.length === 0"
									(click)="onClickBulkDownload($event)">
							</button>
							<!-- 改訂履歴 -->
							<button pButton type="button"
									class="p-button-info eim-form-input-multi-button eim-icon-only-button" icon="eim-icon-revision-history"
									pTooltip="{{ 'EIM_TASKS.LABEL_03030' | translate }}"
									[disabled]="selectedData.length === 0"
									(click)="onClickDispHistory($event)">
							</button>
						</div>
					</div>
			</div>
		<span *ngIf="bottomMessage" [innerHTML]="bottomMessage"></span>
	</div>
</div>

<!-- 成果物ファイル登録(雛型ファイル取込) -->
<ng-container *ngIf="viewDialogName === 'createFileFromTemplate'" novalidate>
	<eim-dialog header="{{ 'EIM_TASKS.LABEL_01015' | translate }}" width="500" height="100%"
			[enableMaximize]="false"
			[visible]="viewDialogName === 'createFileFromTemplate'" modal="true" (close)="viewDialogName = '';">
		<form #fileCreateForm="ngForm" autocomplete="off">
			<!-- 雛型ファイル -->
			<div class="eim-form-item">
				<label class="eim-form-label eim-form-label-required">{{ 'EIM_TASKS.LABEL_02037' | translate }}</label>
			<div class="eim-form-input" style="display: block !important;">
			<p-select name="selectedTemplateFileObject" appendTo="body"
					[options]="templateFileSelectItems" [(ngModel)]="selectedTemplateFileObject" (onChange)="onChangeTemplateFile($event, 0)"
					[required]="true" [style]="{'width':'100%'}" placeholder="{{ 'EIM.INFO_00002' | translate }}"></p-select>
			</div>
			</div>
			<!-- ファイル名 -->
			<div class="eim-form-item">
				<label class="eim-form-label eim-form-label-required">{{ 'EIM.LABEL_02012' | translate }}</label>
			<div class="eim-form-input" style="display: block !important;">
				<input name="createFileName" type="text" pInputText [(ngModel)]="createFileName" [required]="true" style="width: 100%;">
			</div>
			</div>
		</form>
		<footer>
			<button pButton type="button" class="p-button-primary" (click)="onClickAddOutputFileFromTemplateFile($event)" icon="fa fa-check"
					label="{{ 'EIM.LABEL_03005' | translate }}" [disabled]="fileCreateForm.invalid"></button>
		</footer>
	</eim-dialog>
</ng-container>

<!-- チェックイン -->
<ng-container *ngIf="viewDialogName === 'checkinOutputFile'" novalidate>
	<eim-dialog header="{{ 'EIM_DOCUMENTS.LABEL_03029' | translate }}" width="500" height="100%"
			[enableMaximize]="false"
			[visible]="viewDialogName === 'checkinOutputFile'" modal="true" (close)="viewDialogName = '';">

		<div ng2FileDrop [uploader]="uploaderForUpdate" class="well my-drop-zone" style="height: 100%;">
			<form #outputUpdateForm="ngForm" style="width: 100%; height: 100%;" autocomplete="off">
				<div style="height: 100%; padding-top: 0px; padding-left: 0px; padding-bottom: 0px;" eim-vertical-container>
					<div style="margin-bottom: 10px;">
						<eim-text-input-form-item name="name" [(ngModel)]="beforeOutputFileName" label="更新対象" [disabled]="true"></eim-text-input-form-item>
						<div class="eim-form-item">
							<label style="width:21.5%" class="eim-form-label eim-form-label">更新ファイル</label>
							<div class="eim-form-input eim-form-input-selected-list" style="display: flex;">
								<input name="outputFile" type="text" pInputText [(ngModel)]="afterOutputFileName" [disabled]="true" style="width: calc(100% - 30px);"/>
								<label style="margin-left: 5px;" class="eim-upload-btn eim-form-input-multi-button icon-only-button" pTooltip="{{ 'EIM_DOCUMENTS.LABEL_03006' | translate }}" >
									<i class="eim-upload-btn-icon fa fa-upload"></i>
									<input #dummyID type="file" ng2FileSelect
											[uploader]="uploaderForUpdate" single [ngStyle]="{'display': 'none'}"/>
								</label>
							</div>
						</div>
					</div>
				</div>
			</form>
		</div>
		<footer>
			<button pButton type="button" class="p-button-primary" (click)="onClickUpdateOutputFile($event)" icon="fa fa-check"
					label="{{ 'EIM.LABEL_03005' | translate }}" [disabled]="outputUpdateForm.invalid"></button>
		</footer>
	</eim-dialog>
</ng-container>

<!-- 改訂履歴（成果物） -->
<ng-container *ngIf="viewDialogName === 'revisionHistory'" novalidate>
	<eim-dialog header="{{ 'EIM_DOCUMENTS.LABEL_01006' | translate }}" modal="true" width="735" height="400"
	[visible]="viewDialogName === 'revisionHistory'" modal="true" (close)="viewDialogName = '';"
	[name]="name">

		<div class="eim-flexible-height" style="height: 100%;">
			<eim-task-revision-history 
				[targetContent]="taskOutputFileDataGrid.getSelectedData()[0]" (errored)="viewDialogName = '';"
				[isDispReivisonDetail]="false">
			</eim-task-revision-history>
		</div>
	</eim-dialog>
</ng-container>
