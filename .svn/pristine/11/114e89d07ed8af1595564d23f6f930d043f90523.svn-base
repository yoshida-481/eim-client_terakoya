<form #ngForm="ngForm" class="eim-form-wide" style="height: 100%; overflow-y: auto;" autocomplete="off" novalidate>

	<p-tabs [value]="tabIndex()" (valueChange)="onChangeTab($event)" class="eim-tab">
		<p-tablist>
			<!-- 全般 -->
			<p-tab [value]="0">{{ 'EIM_TASKS.LABEL_02033' | translate }}</p-tab>
			<!-- 詳細 -->
			<p-tab [value]="1">{{ 'EIM_TASKS.LABEL_02034' | translate }}</p-tab>
			<!-- メモ -->
			<p-tab [value]="2">{{ 'EIM_TASKS.LABEL_02049' | translate }}</p-tab>
		</p-tablist>
		<p-tabpanels>
			<!-- 全般 -->
			<p-tabpanel [value]="0">
				<div style="padding:5px; height: 100%">
					<p-panel class="eim-panel-flat" [header]="taskDTO?.name">
						<eim-task-form #circulateForm [form]="ngForm.form" [disabled]="componentDisabled"
							(changed)="onChanged($event)">
						</eim-task-form>
					</p-panel>

					<div *ngIf="isDisplayWorkflow">
						<p-panel class="eim-panel-flat" header="{{ 'EIM_TASKS.LABEL_02038' | translate }}">
							<eim-task-workflow-diagram #workflowDiagram [componentService]="workflowDiagramComponentService"
								[formFormatResult]="formFormatResult">
							</eim-task-workflow-diagram>
						</p-panel>
						<a href="#" style="color: #0044CC; text-align: right; display: table; margin-left: auto;"
							(click)="onClickProcessingHistory($event)">
							{{ 'EIM_TASKS.LABEL_01018' | translate }}
						</a>
					</div>
				</div>
			</p-tabpanel>
			<!-- 詳細 -->
			<p-tabpanel [value]="1">
				<div style="padding:5px; height: 100%">
					<eim-task-form #propertyForm [form]="ngForm.form" [disabled]="componentDisabled"
						(changed)="onChangedPropertyForm($event)">
					</eim-task-form>
					<eim-task-form #taskForm [form]="ngForm.form" [disabled]="componentDisabled">
					</eim-task-form>
				</div>
			</p-tabpanel>
			<!-- メモ -->
			<p-tabpanel [value]="2" class="eim-task-updator-tab-panel-memo">
				<div style="padding:5px; height: 100%">
					<eim-task-form #memoForm [form]="ngForm.form" [disabled]="componentDisabled"
						class="eim-task-updator-form-memo">
					</eim-task-form>
				</div>
			</p-tabpanel>
		</p-tabpanels>
	</p-tabs>
</form>

<!-- 処理履歴一覧 -->
<ng-container *ngIf="viewDialogName === 'processingHistory'" novalidate>
	<eim-dialog header="{{ 'EIM_TASKS.LABEL_01018' | translate }}" modal="true" width="1025" height="400"
	[visible]="viewDialogName === 'processingHistory'" modal="true" (close)="viewDialogName = '';"
	[name]="name">

		<div class="eim-flexible-height" style="height: 100%;">
			<eim-task-processing-history (errored)="viewDialogName = '';"
				[taskId]="taskId">
			</eim-task-processing-history>
		</div>
	</eim-dialog>
</ng-container>

<!-- ステータス変更 -->
<ng-container *ngIf="viewDialogName === 'taskStatusChangeExecutor'" novalidate>
	<eim-dialog *ngIf="viewDialogName === 'taskStatusChangeExecutor'"
			header="{{ 'EIM_TASKS.LABEL_01016' | translate }}" modal="true" width="845"
			[visible]="true"
			[enableMaximize]="false"
			(close)="onCloseDialog()">
		<eim-task-status-change-executor
				[objectDTO]="taskDTO"
				[workflow]="taskDTO.exAttributeMap['workflow']"
				[eventTypeList]="eventTypes"
				(executed)="onChangeStatus($event)"
				(rejected)="onCloseDialog()"
		>
		</eim-task-status-change-executor>
	</eim-dialog>
</ng-container>

<!-- ステータス取戻し -->
<ng-container *ngIf="viewDialogName === 'taskStatusRegainExecutor'" novalidate>
	<eim-dialog *ngIf="viewDialogName === 'taskStatusRegainExecutor'"
			header="{{ 'EIM_TASKS.LABEL_01025' | translate }}" modal="true" width="675" height="280"
			[visible]="true"
			[enableMaximize]="false"
			(close)="onCloseDialog()">
		<eim-task-status-regain-executor
			[objectDTO]="taskDTO"
			[regainEventType]="regainEventType"
			(executed)="onChangeStatus($event)"
		>
		</eim-task-status-regain-executor>
	</eim-dialog>
</ng-container>

<!-- メール送信 -->
<ng-container *ngIf="viewDialogName === 'mailSendExecutor'" novalidate>
	<eim-dialog *ngIf="viewDialogName === 'mailSendExecutor'" 
		header="{{ 'EIM_TASKS.LABEL_01021' | translate }}" modal="true" width="1145" height="870"
		[visible]="true"
		[enableMaximize]="false"
		(close)="onCloseDialog()"
	>
		<eim-project-member-mail-send-executor
			[workspaceId]="workspaceId"
			[taskId]="taskId"
			(executed)="onExecutedSendMail($event)">

		</eim-project-member-mail-send-executor>
	</eim-dialog>
</ng-container>
